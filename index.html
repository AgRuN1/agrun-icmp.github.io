
<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <title>AgRuN Programming</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  </head>
  <body>
  <div class="container">
        <h1 class="text-center">Последние решенные задачи:</h1>
        <table id="app" class="table">
          <thead>
            <tr>
              <td>Название</td>
              <td>Контест</td>
              <td>Язык</td>
              <td>Теги</td>
              <td>Дата</td>
            </tr>
          </thead>
          <tr v-for="t in tasks">
            <td>{{ t.problem.name }}</td>
            <td>
              <a v-bind:href="getLink(t.problem)" target="_blank">
                {{ t.problem.contestId }}
              </a>
            </td>
            <td>{{ t.programmingLanguage }}</td>
            <td>{{ t.problem.tags.length ? t.problem.tags.join(', ') : ' - ' }}</td>
            <td>{{ getDate(t.creationTimeSeconds) }}</td>
          </tr>
        </table>
  </div>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script>
    var app = new Vue({
      el: '#app',
      data: {
        tasks: []
      },
      created: function(){
        this.query();
        setInterval(this.query.bind(this), 30 * 1000);
      },
      methods: {
        update(data){
          var tasks = [];
          var mp = {};
          for(var res of data){
            var id = res.problem.contestId + res.problem.index;
            if(!mp[id] && res.verdict == "OK" && res.author.members.length == 1){
              tasks.push(res);
              if(tasks.length == 10) break;
              mp[id] = 1;
            }
          }
          this.tasks = tasks;
        },
        query(){
          $.ajax('https://codeforces.com/api/user.status?handle=blackmart&from=1&count=100')
          .done(data => this.update(data['result']))
          .fail(err => { console.log(err) });
        },
        getLink(problem){
          return `https://codeforces.com/${problem.rating ? 'contest' : 'gym'}/${problem.contestId}`;
        },
        getDate(sec){
          var opt = v => v < 10 ? '0' + v : v;
          var d = new Date(sec * 1000);
          var day = opt(d.getDay() + 1), month = opt(d.getMonth()), hours = opt(d.getHours()), mins = opt(d.getMinutes());
          return `${day}.${month}.${d.getFullYear()} ${hours}:${mins}`;
        }
      }
    });
  </script>
</body>
</html>